{% extends "layout.njk" %}

{% block title %}Mempool Â· Slim Bitcoin Explorer{% endblock %}
{% block page_id %}mempool{% endblock %}

{% block content %}
  <div class="card">
    <h2>Mempool Overview</h2>
    <p><strong>Transactions:</strong> <span id="mempool-tx-count">{{ mempool.snapshot.txCount | default('n/a') }}</span></p>
    <p><strong>Virtual Size:</strong> <span id="mempool-virtual-size">{{ mempool.snapshot.virtualSize | default('n/a') }}</span></p>
    <p><strong>Median Fee Rate (sat/vB):</strong> <span id="mempool-median-fee">{{ mempool.snapshot.medianFee | default('n/a') }}</span></p>
    <p class="muted">Last updated: <span id="mempool-updated-at">{{ mempool.snapshot.updatedAt | default('n/a') }}</span></p>
  </div>

  <div class="card">
    <h2>Fee Histogram (sat/vB)</h2>
    <table>
      <thead>
        <tr>
          <th>Range</th>
          <th>Transactions</th>
          <th>Virtual Size</th>
        </tr>
      </thead>
      <tbody data-role="mempool-histogram">
        {% for bucket in mempool.snapshot.histogram %}
          <tr>
            <td>{{ bucket.range }}</td>
            <td>{{ bucket.count }}</td>
            <td>{{ bucket.vsize }}</td>
          </tr>
        {% else %}
          <tr>
            <td colspan="3" class="muted">No histogram data available.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h2>Recent Transactions (page {{ mempool.pagination.page }} of {{ mempool.pagination.totalPages }})</h2>
    <table>
      <thead>
        <tr>
          <th>TxID</th>
          <th>Fee Rate (sat/vB)</th>
          <th>vSize</th>
          <th>Age (s)</th>
          <th>RBF</th>
        </tr>
      </thead>
      <tbody data-role="mempool-recent">
        {% for tx in mempool.snapshot.recent %}
          <tr>
            <td><a href="/tx/{{ tx.txid }}"><code>{{ tx.txid }}</code></a></td>
            <td>{{ tx.feerate | default('n/a') }}</td>
            <td>{{ tx.vsize }}</td>
            <td>{{ tx.ageSeconds | default('n/a') }}</td>
            <td>{{ tx.isRbf and 'Yes' or 'No' }}</td>
          </tr>
        {% else %}
          <tr>
            <td colspan="5" class="muted">No transactions currently tracked.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">
      {% if mempool.pagination.page > 1 %}
        <a href="?page={{ mempool.pagination.page - 1 }}">Previous</a>
      {% endif %}
      <span id="mempool-pagination">Page {{ mempool.pagination.page }} / {{ mempool.pagination.totalPages }}</span>
      {% if mempool.pagination.page < mempool.pagination.totalPages %}
        <a href="?page={{ mempool.pagination.page + 1 }}">Next</a>
      {% endif %}
    </div>
  </div>
{% endblock %}
